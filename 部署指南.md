# 学生信息管理系统 - 部署指南

## 一、环境要求

- Node.js (版本 14 或以上)
- MongoDB (版本 4.4 或以上)
- Nginx (可选，用于生产环境部署)

## 二、安装步骤

### 2.1 安装 MongoDB

1. **下载 MongoDB**
   - 访问 https://www.mongodb.com/try/download/community
   - 下载适合您操作系统的版本

2. **启动 MongoDB 服务**
   ```bash
   # Windows
   mongod --dbpath C:\data\db
   
   # Linux/Mac
   mongod --dbpath /data/db
   ```

3. **验证 MongoDB 是否运行**
   ```bash
   mongo --version
   ```

### 2.2 安装后端依赖

```bash
cd backend
npm install
```

### 2.3 配置环境变量

1. 复制环境配置文件：
   ```bash
   cd backend
   cp .env.example .env
   ```

2. 编辑 `.env` 文件（如果需要修改端口或数据库连接）：
   ```
   PORT=3000
   MONGODB_URI=mongodb://localhost:27017/student_management
   ```

### 2.4 启动后端服务

```bash
cd backend
npm start
# 或使用开发模式（自动重启）
npm run dev
```

服务启动后会显示：
```
✅ MongoDB 连接成功
🚀 服务器运行在 http://localhost:3000
```

### 2.5 直接访问前端（开发模式）

直接用浏览器打开前端文件：
```
file:///E:/study/Git/student-management-system/frontend/index.html
```

**注意**：由于 CORS 限制，建议使用 Nginx 部署或使用 HTTP 服务器。

## 三、使用 Nginx 部署（推荐）

### 3.1 安装 Nginx

**Windows:**
1. 下载 Nginx: http://nginx.org/en/download.html
2. 解压到 C:\nginx

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install nginx
```

### 3.2 配置 Nginx

1. **Windows:**
   - 编辑 `C:\nginx\conf\nginx.conf`
   - 或复制项目中的 `nginx.conf` 到 `C:\nginx\conf\nginx.conf`

2. **Linux:**
   ```bash
   sudo cp nginx.conf /etc/nginx/sites-available/student-management.conf
   sudo ln -s /etc/nginx/sites-available/student-management.conf /etc/nginx/sites-enabled/
   ```

3. **修改配置文件中的路径**：
   将配置文件中的前端路径修改为实际路径：
   ```nginx
   root E:/study/Git/student-management-system/frontend;
   ```

### 3.3 启动 Nginx

**Windows:**
```bash
cd C:\nginx
start nginx
# 或
nginx.exe
```

**Linux:**
```bash
sudo systemctl start nginx
# 或
sudo nginx
```

### 3.4 重启 Nginx（修改配置后）

**Windows:**
```bash
nginx.exe -s reload
```

**Linux:**
```bash
sudo nginx -s reload
# 或
sudo systemctl reload nginx
```

### 3.5 访问应用

打开浏览器访问：
```
http://localhost
```

## 四、测试 API

### 4.1 使用浏览器测试

访问健康检查接口：
```
http://localhost:3000/api/health
```

### 4.2 使用 PowerShell 测试 API

```powershell
# 测试健康检查
Invoke-RestMethod -Uri http://localhost:3000/api/health

# 创建学生
$body = @{
    name = "张三"
    studentId = "2024001"
    class = "一班"
    score = 95
} | ConvertTo-Json

Invoke-RestMethod -Uri http://localhost:3000/api/students -Method Post -Body $body -ContentType "application/json"

# 获取所有学生
Invoke-RestMethod -Uri http://localhost:3000/api/students
```

## 五、功能使用说明

### 5.1 添加学生信息
1. 填写学生姓名、学号、班级、成绩
2. 点击"提交"按钮
3. 学生信息会显示在下方列表中

### 5.2 编辑学生信息
1. 点击列表中的"编辑"按钮
2. 表单会自动填充该学生的信息
3. 修改后点击"更新"按钮

### 5.3 删除学生信息
1. 点击列表中的"删除"按钮
2. 确认删除操作

### 5.4 筛选学生
1. 在筛选区域输入班级或成绩范围
2. 点击"筛选"按钮
3. 点击"重置"可清除筛选条件

### 5.5 生成 AI 分析报告
1. 点击"🤖 AI 分析报告"按钮
2. 系统会自动生成包含以下内容的报告：
   - 整体统计（平均分、最高分、最低分等）
   - 成绩分布（优秀、良好、及格、不及格人数）
   - 班级分析
   - 成绩排名 Top 10
   - AI 改进建议

## 六、故障排查

### 6.1 MongoDB 连接失败

**错误信息**：
```
❌ MongoDB 连接失败: connect ECONNREFUSED
```

**解决方法**：
1. 确认 MongoDB 服务已启动
2. 检查 `.env` 文件中的数据库连接地址
3. 确认端口 27017 未被占用

### 6.2 CORS 错误

**错误信息**：
```
Access to fetch at 'http://localhost:3000/api/students' from origin 'null' has been blocked by CORS policy
```

**解决方法**：
1. 使用 Nginx 部署前端
2. 或者使用 HTTP 服务器启动前端（不要直接打开 HTML 文件）

### 6.3 端口被占用

**错误信息**：
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决方法**：
1. 修改 `.env` 文件中的 PORT 配置
2. 或者关闭占用端口的程序

**Windows 查找占用端口的程序**：
```powershell
netstat -ano | findstr :3000
taskkill /PID <PID> /F
```

### 6.4 Nginx 无法启动

**检查配置文件语法**：
```bash
nginx -t
```

**查看错误日志**：
```bash
# Windows
type C:\nginx\logs\error.log

# Linux
tail -f /var/log/nginx/error.log
```

## 七、停止服务

### 7.1 停止后端服务
在运行后端的终端中按 `Ctrl + C`

### 7.2 停止 Nginx

**Windows:**
```bash
nginx.exe -s stop
```

**Linux:**
```bash
sudo systemctl stop nginx
# 或
sudo nginx -s stop
```

### 7.3 停止 MongoDB

**Windows:**
在运行 MongoDB 的终端中按 `Ctrl + C`

**Linux:**
```bash
sudo systemctl stop mongod
```

## 八、生产环境建议

1. **数据库安全**：
   - 为 MongoDB 添加认证
   - 使用强密码
   - 限制数据库访问 IP

2. **Nginx 优化**：
   - 启用 gzip 压缩
   - 配置 SSL 证书（HTTPS）
   - 设置访问日志和错误日志

3. **后端优化**：
   - 添加请求频率限制
   - 实现用户认证和授权
   - 添加日志记录
   - 使用 PM2 管理 Node.js 进程

4. **备份**：
   - 定期备份 MongoDB 数据
   - 备份配置文件

## 九、项目结构

```
student-management-system/
├── backend/                 # 后端代码
│   ├── server.js           # 主服务器文件
│   ├── package.json        # 依赖配置
│   ├── .env.example        # 环境变量示例
│   └── .env                # 环境变量（需创建）
├── frontend/               # 前端代码
│   ├── index.html          # 主页面
│   ├── styles.css          # 样式文件
│   └── app.js              # 前端逻辑
├── nginx.conf              # Nginx 配置文件
├── .gitignore              # Git 忽略文件
├── 需求拆解文档.md          # 需求文档
└── 部署指南.md              # 本文档
```

## 十、联系与支持

如遇到问题，请检查：
1. 所有服务是否正常启动
2. 配置文件路径是否正确
3. 端口是否被占用
4. 防火墙设置是否阻止了连接
